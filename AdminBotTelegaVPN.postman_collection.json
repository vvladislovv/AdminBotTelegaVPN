{
    "info": {
        "name": "AdminBotTelegaVPN",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "Auth",
            "item": [
                {
                    "name": "Login",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.access_token) {",
                                    "    pm.environment.set('token', jsonData.access_token);",
                                    "    console.log('Token saved successfully');",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"admin@example.com\",\n    \"password\": \"admin123\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/auth/login",
                            "host": ["{{baseUrl}}"],
                            "path": ["auth", "login"]
                        }
                    }
                },
                {
                    "name": "Get Profile",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/auth/me",
                            "host": ["{{baseUrl}}"],
                            "path": ["auth", "me"]
                        }
                    }
                },
                {
                    "name": "Logout",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/auth/logout",
                            "host": ["{{baseUrl}}"],
                            "path": ["auth", "logout"]
                        }
                    }
                },
                {
                    "name": "Register",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.access_token) {",
                                    "    pm.environment.set('token', jsonData.access_token);",
                                    "    console.log('Token saved successfully after registration');",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"new_user@example.com\",\n    \"password\": \"password123\",\n    \"name\": \"New User\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/auth/register",
                            "host": ["{{baseUrl}}"],
                            "path": ["auth", "register"]
                        }
                    }
                },
                {
                    "name": "Register with Referral",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.access_token) {",
                                    "    pm.environment.set('token', jsonData.access_token);",
                                    "    pm.environment.set('newUserToken', jsonData.access_token);",
                                    "    console.log('Token saved successfully after registration with referral');",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"new_user@example.com\",\n    \"password\": \"password123\",\n    \"name\": \"New User\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/auth/register?ref={{referralCode}}",
                            "host": ["{{baseUrl}}"],
                            "path": ["auth", "register"],
                            "query": [
                                {
                                    "key": "ref",
                                    "value": "{{referralCode}}"
                                }
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Me",
            "item": [
                {
                    "name": "Referrals",
                    "item": [
                        {
                            "name": "Get Referrals",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/referrals",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "referrals"]
                                }
                            }
                        },
                        {
                            "name": "Get New Referral Link",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.code) {",
                                            "    pm.environment.set('referralCode', jsonData.code);",
                                            "    // Формируем полную ссылку для регистрации",
                                            "    var fullLink = '{{baseUrl}}/auth/register?ref=' + jsonData.code;",
                                            "    pm.environment.set('fullReferralLink', fullLink);",
                                            "    console.log('Referral code saved:', jsonData.code);",
                                            "    console.log('Full referral link:', fullLink);",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/referrals/new",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "referrals", "new"]
                                }
                            }
                        },
                        {
                            "name": "Simulate Referral Registration",
                            "event": [
                                {
                                    "listen": "prerequest",
                                    "script": {
                                        "exec": [
                                            "// Генерируем уникальный email для теста",
                                            "var timestamp = new Date().getTime();",
                                            "var testEmail = 'test_user_' + timestamp + '@example.com';",
                                            "pm.environment.set('testEmail', testEmail);",
                                            "console.log('Generated test email:', testEmail);"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"email\": \"{{testEmail}}\",\n    \"password\": \"password123\",\n    \"name\": \"Test User\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/auth/register?ref={{referralCode}}",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["auth", "register"],
                                    "query": [
                                        {
                                            "key": "ref",
                                            "value": "{{referralCode}}"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "Track Referral Click",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/referrals/track/{{referralCode}}",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "referrals", "track", "{{referralCode}}"]
                                }
                            }
                        },
                        {
                            "name": "Check Referral Status",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/referrals",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "referrals"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Subscribe Billing (TelegaPay)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"plan\": \"PREMIUM\",\n    \"botId\": 1\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/me/billing/subscribe",
                            "host": ["{{baseUrl}}"],
                            "path": ["me", "billing", "subscribe"]
                        }
                    }
                },
                {
                    "name": "Get Billing Status",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/me/billing/status",
                            "host": ["{{baseUrl}}"],
                            "path": ["me", "billing", "status"]
                        }
                    }
                },
                {
                    "name": "Get Billing Info",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/me/billing",
                            "host": ["{{baseUrl}}"],
                            "path": ["me", "billing"]
                        }
                    }
                },
                {
                    "name": "Get CRM User Info",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/me/crm/usersinfo",
                            "host": ["{{baseUrl}}"],
                            "path": ["me", "crm", "usersinfo"]
                        }
                    }
                },
                {
                    "name": "Get CRM Connections",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/me/crm/connections",
                            "host": ["{{baseUrl}}"],
                            "path": ["me", "crm", "connections"]
                        }
                    }
                },
                {
                    "name": "Bots",
                    "item": [
                        {
                            "name": "Create Bot",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"Test Bot\",\n    \"token\": \"YOUR_BOT_TOKEN_HERE\",\n    \"username\": \"test_bot_username\",\n    \"link\": \"https://t.me/test_bot_username\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/me/bots",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "bots"]
                                }
                            }
                        },
                        {
                            "name": "Get All Bots",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/bots",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "bots"]
                                }
                            }
                        },
                        {
                            "name": "Get Bot by ID",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/bots/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "bots", "1"]
                                }
                            }
                        },
                        {
                            "name": "Update Bot",
                            "request": {
                                "method": "PATCH",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"Updated Bot Name\",\n    \"token\": \"new_telegram_bot_token\",\n    \"link\": \"https://t.me/updated_bot_username\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/me/bots/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "bots", "1"]
                                }
                            }
                        },
                        {
                            "name": "Delete Bot",
                            "request": {
                                "method": "DELETE",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/bots/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "bots", "1"]
                                }
                            }
                        },
                        {
                            "name": "Get Bot Stats",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/bots/1/stats",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "bots", "1", "stats"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Tickets",
                    "item": [
                        {
                            "name": "Create Ticket",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"subject\": \"Test Ticket\",\n    \"message\": \"This is a test ticket message\",\n    \"botId\": 1,\n    \"telegramId\": 123456789\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/me/tickets",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "tickets"]
                                }
                            }
                        },
                        {
                            "name": "Get All Tickets",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/tickets",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "tickets"]
                                }
                            }
                        },
                        {
                            "name": "Get Ticket by ID",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/tickets/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "tickets", "1"]
                                }
                            }
                        },
                        {
                            "name": "Update Ticket",
                            "request": {
                                "method": "PATCH",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"status\": \"CLOSED\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/me/tickets/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "tickets", "1"]
                                }
                            }
                        },
                        {
                            "name": "Delete Ticket",
                            "request": {
                                "method": "DELETE",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/tickets/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "tickets", "1"]
                                }
                            }
                        },
                        {
                            "name": "Add Message to Ticket",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"message\": \"This is a new message in the ticket\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/me/tickets/1/messages",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "tickets", "1", "messages"]
                                }
                            }
                        },
                        {
                            "name": "Get Ticket Messages",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/me/tickets/1/messages",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["me", "tickets", "1", "messages"]
                                }
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "Admin",
            "item": [
                {
                    "name": "Clients",
                    "item": [
                        {
                            "name": "Get All Clients",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/admin/clients",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["admin", "clients"]
                                }
                            }
                        },
                        {
                            "name": "Create Client",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"email\": \"new.client@example.com\",\n    \"password\": \"password123\",\n    \"name\": \"New Client\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/admin/clients",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["admin", "clients"]
                                }
                            }
                        },
                        {
                            "name": "Get Client by ID",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/admin/clients/{{clientId}}",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["admin", "clients", "{{clientId}}"]
                                }
                            }
                        },
                        {
                            "name": "Update Client",
                            "request": {
                                "method": "PATCH",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"Updated Client Name\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/admin/clients/{{clientId}}",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["admin", "clients", "{{clientId}}"]
                                }
                            }
                        },
                        {
                            "name": "Delete Client",
                            "request": {
                                "method": "DELETE",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/admin/clients/{{clientId}}",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["admin", "clients", "{{clientId}}"]
                                }
                            }
                        },
                        {
                            "name": "Bots (Admin)",
                            "item": [
                                {
                                    "name": "Create Bot for Client",
                                    "request": {
                                        "method": "POST",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            },
                                            {
                                                "key": "Content-Type",
                                                "value": "application/json"
                                            }
                                        ],
                                        "body": {
                                            "mode": "raw",
                                            "raw": "{\n    \"name\": \"Test Bot for Client\",\n    \"token\": \"YOUR_BOT_TOKEN_HERE\",\n    \"username\": \"@test_bot_username\"\n}"
                                        },
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/bots",
                                            "host": ["{{baseUrl}}"],
                                            "path": ["admin", "clients", "{{clientId}}", "bots"]
                                        }
                                    }
                                },
                                {
                                    "name": "Get Bot for Client by ID",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/bots/{{botId}}",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "bots",
                                                "{{botId}}"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Update Bot for Client",
                                    "request": {
                                        "method": "PATCH",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            },
                                            {
                                                "key": "Content-Type",
                                                "value": "application/json"
                                            }
                                        ],
                                        "body": {
                                            "mode": "raw",
                                            "raw": "{\n    \"name\": \"Updated Bot Name\",\n    \"token\": \"new_telegram_bot_token\",\n    \"username\": \"@updated_bot_username\"\n}"
                                        },
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/bots/{{botId}}",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "bots",
                                                "{{botId}}"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Delete Bot for Client",
                                    "request": {
                                        "method": "DELETE",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/bots/{{botId}}",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "bots",
                                                "{{botId}}"
                                            ]
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "Tickets (Admin)",
                            "item": [
                                {
                                    "name": "Get All Tickets for Client",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/tickets",
                                            "host": ["{{baseUrl}}"],
                                            "path": ["admin", "clients", "{{clientId}}", "tickets"]
                                        }
                                    }
                                },
                                {
                                    "name": "Create Ticket for Client",
                                    "request": {
                                        "method": "POST",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            },
                                            {
                                                "key": "Content-Type",
                                                "value": "application/json"
                                            }
                                        ],
                                        "body": {
                                            "mode": "raw",
                                            "raw": "{\n    \"subject\": \"Test Ticket for Client\",\n    \"message\": \"Message for client ticket\",\n    \"botId\": 1,\n    \"telegramId\": 123456789\n}"
                                        },
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/tickets",
                                            "host": ["{{baseUrl}}"],
                                            "path": ["admin", "clients", "{{clientId}}", "tickets"]
                                        }
                                    }
                                },
                                {
                                    "name": "Get Ticket for Client by ID",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/tickets/{{ticketId}}",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "tickets",
                                                "{{ticketId}}"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Update Ticket for Client",
                                    "request": {
                                        "method": "PATCH",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            },
                                            {
                                                "key": "Content-Type",
                                                "value": "application/json"
                                            }
                                        ],
                                        "body": {
                                            "mode": "raw",
                                            "raw": "{\n    \"status\": \"CLOSED\"\n}"
                                        },
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/tickets/{{ticketId}}",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "tickets",
                                                "{{ticketId}}"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Delete Ticket for Client",
                                    "request": {
                                        "method": "DELETE",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/tickets/{{ticketId}}",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "tickets",
                                                "{{ticketId}}"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Add Message to Ticket for Client",
                                    "request": {
                                        "method": "POST",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            },
                                            {
                                                "key": "Content-Type",
                                                "value": "application/json"
                                            }
                                        ],
                                        "body": {
                                            "mode": "raw",
                                            "raw": "{\n    \"message\": \"New message from admin\"\n}"
                                        },
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/tickets/{{ticketId}}/messages",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "tickets",
                                                "{{ticketId}}",
                                                "messages"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Get Ticket Messages for Client",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/tickets/{{ticketId}}/messages",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "tickets",
                                                "{{ticketId}}",
                                                "messages"
                                            ]
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "Referrals (Admin)",
                            "item": [
                                {
                                    "name": "Get Client Referrals",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/me/referrals",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "me",
                                                "referrals"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Get Client Referral Stats",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/me/referrals/stats",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "me",
                                                "referrals",
                                                "stats"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Get Client Referral Links",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/me/referrals/links",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "me",
                                                "referrals",
                                                "links"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Get Client Referral Bonuses",
                                    "request": {
                                        "method": "GET",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/me/referrals/bonuses",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "me",
                                                "referrals",
                                                "bonuses"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Update Client Referral Bonuses (Admin)",
                                    "request": {
                                        "method": "PATCH",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            },
                                            {
                                                "key": "Content-Type",
                                                "value": "application/json"
                                            }
                                        ],
                                        "body": {
                                            "mode": "raw",
                                            "raw": "{\n    \"totalBonus\": 200,\n    \"pendingBonus\": 50\n}"
                                        },
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/me/referrals/bonuses",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "me",
                                                "referrals",
                                                "bonuses"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "name": "Delete Client Referral Link (Admin)",
                                    "request": {
                                        "method": "DELETE",
                                        "header": [
                                            {
                                                "key": "Authorization",
                                                "value": "Bearer {{token}}"
                                            }
                                        ],
                                        "url": {
                                            "raw": "{{baseUrl}}/admin/clients/{{clientId}}/me/referrals/links/{{linkId}}",
                                            "host": ["{{baseUrl}}"],
                                            "path": [
                                                "admin",
                                                "clients",
                                                "{{clientId}}",
                                                "me",
                                                "referrals",
                                                "links",
                                                "{{linkId}}"
                                            ]
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "CRM",
            "item": [
                {
                    "name": "Users",
                    "item": [
                        {
                            "name": "Create User",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"phone\": \"+1234567890\",\n    \"telegramId\": \"123456789\",\n    \"telegramUsername\": \"johndoe\",\n    \"notes\": \"VIP client\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/users",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "users"]
                                }
                            }
                        },
                        {
                            "name": "Get User",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/users/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "users", "1"]
                                }
                            }
                        },
                        {
                            "name": "Update User",
                            "request": {
                                "method": "PUT",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"John Updated\",\n    \"email\": \"john.updated@example.com\",\n    \"status\": \"active\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/users/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "users", "1"]
                                }
                            }
                        },
                        {
                            "name": "Delete User",
                            "request": {
                                "method": "DELETE",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/users/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "users", "1"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Subscriptions",
                    "item": [
                        {
                            "name": "Create Subscription",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"userId\": \"1\",\n    \"planId\": \"premium\",\n    \"autoRenew\": true,\n    \"paymentMethod\": \"card\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/subscriptions",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "subscriptions"]
                                }
                            }
                        },
                        {
                            "name": "Get Subscription",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/subscriptions/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "subscriptions", "1"]
                                }
                            }
                        },
                        {
                            "name": "Update Subscription",
                            "request": {
                                "method": "PUT",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"autoRenew\": false,\n    \"paymentMethod\": \"crypto\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/subscriptions/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "subscriptions", "1"]
                                }
                            }
                        },
                        {
                            "name": "Cancel Subscription",
                            "request": {
                                "method": "DELETE",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/subscriptions/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "subscriptions", "1"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Payments",
                    "item": [
                        {
                            "name": "Create Payment",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"userId\": \"1\",\n    \"amount\": 10.99,\n    \"currency\": \"USD\",\n    \"description\": \"Monthly subscription\",\n    \"paymentMethod\": \"card\",\n    \"metadata\": {\n        \"subscriptionId\": \"1\"\n    }\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/payments",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "payments"]
                                }
                            }
                        },
                        {
                            "name": "Get Payment",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/payments/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "payments", "1"]
                                }
                            }
                        },
                        {
                            "name": "Refund Payment",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"amount\": 5.99\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/payments/1/refund",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "payments", "1", "refund"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Servers",
                    "item": [
                        {
                            "name": "Get All Servers",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/servers",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "servers"]
                                }
                            }
                        },
                        {
                            "name": "Get Server",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/servers/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "servers", "1"]
                                }
                            }
                        },
                        {
                            "name": "Update Server Status",
                            "request": {
                                "method": "PUT",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"status\": \"maintenance\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/servers/1/status",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "servers", "1", "status"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Configs",
                    "item": [
                        {
                            "name": "Generate Config",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    },
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"userId\": \"1\",\n    \"serverId\": \"1\"\n}"
                                },
                                "url": {
                                    "raw": "{{baseUrl}}/crm/configs",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "configs"]
                                }
                            }
                        },
                        {
                            "name": "Get Config",
                            "request": {
                                "method": "GET",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/configs/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "configs", "1"]
                                }
                            }
                        },
                        {
                            "name": "Revoke Config",
                            "request": {
                                "method": "DELETE",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{token}}"
                                    }
                                ],
                                "url": {
                                    "raw": "{{baseUrl}}/crm/configs/1",
                                    "host": ["{{baseUrl}}"],
                                    "path": ["crm", "configs", "1"]
                                }
                            }
                        }
                    ]
                }
            ]
        }
    ],
    "event": [
        {
            "listen": "prerequest",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Проверяем, есть ли токен",
                    "if (!pm.environment.get('token')) {",
                    "    console.log('No token found, attempting to login...');",
                    "    // Выполняем запрос на логин",
                    "    pm.sendRequest({",
                    "        url: pm.environment.get('baseUrl') + '/auth/login',",
                    "        method: 'POST',",
                    "        header: {",
                    "            'Content-Type': 'application/json'",
                    "        },",
                    "        body: {",
                    "            mode: 'raw',",
                    "            raw: JSON.stringify({",
                    "                email: 'admin@example.com',",
                    "                password: 'admin123'",
                    "            })",
                    "        }",
                    "    }, function (err, res) {",
                    "        if (err) {",
                    "            console.error('Login failed:', err);",
                    "        } else {",
                    "            var jsonData = res.json();",
                    "            if (jsonData.access_token) {",
                    "                pm.environment.set('token', jsonData.access_token);",
                    "                console.log('Token obtained and saved successfully');",
                    "            } else {",
                    "                console.error('No token in response');",
                    "            }",
                    "        }",
                    "    });",
                    "} else {",
                    "    console.log('Token exists:', pm.environment.get('token'));",
                    "}",
                    "// Устанавливаем frontend URL если не установлен",
                    "if (!pm.environment.get('frontendUrl')) {",
                    "    pm.environment.set('frontendUrl', 'http://localhost:3000');",
                    "}"
                ]
            }
        }
    ]
}
